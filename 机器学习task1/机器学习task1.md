# 机器学习task1-波士顿房价预测
[github链接](git@github.com:cailibin00/machinelearning.git)
在写题之前，我先学习了pytorch一点基本的框架，能大概写出一个线性回归的模型，然而，在写题的过程之中还是遇到种种困难，靠着看文档和向AI提问，解决了大部分的问题。下面就是我在本次task1之中的实验过程和结果分析

## 实验报告

 * **代码框架简述**：
1. **数据的预处理**：首先是使用pandas导入数据，接着对数据进行处理，分为四步。一是缺失值处理，我使用了SimpleImputer，二是异常值处理，使用了Isolateforest，三是划分数据集，我按照7-1.5-1.5的比例分别划分出训练集，验证集，测试集，第四是归一化，去除ID一列，将特征和标签分别归一化
2. **数据集和数据加载器**：使用自定义的Dataset和DataLoader
3. **MLP模型结构**：分为一个输入层，两个隐藏层和一个输出层，在前向传播过程中使用relu激活函数，引入非线性因素；使用常见的损失函数MSE和SGD随机梯度下降优化器
4. **训练与验证**：在训练集之中反向传播，优化权重和偏置参数，并且，在每个epoch的训练之后，都使用验证集评估每次训练完的模型，打印出平均的MSE损失作为**评估的标准**并作图记录
5. **分区评估**：我使用这个测试集来评估，并且将预测效果分区间显示，具体实现为：将数据通过模型得到预测的标签，通过**反归一化**之后，分各个价格区间，与真实标签计算出平均mse损失，最后使用柱状图来可视化预测效果
6. **预测房价**：使用训练得到的模型，得到预测的标签，再通过与训练集相同的对象target_sclaer来反归一化，连同对应ID写入文件submission


* **训练过程**
1. **模型选择**：
通过比较不同的隐藏层参数：13->16->8->1,13->32->10->1,13->8->3->1,我们发现最后的**数据对2**能得到最好的结果，当然还尝试了减少隐藏层13->32->1,13->5->1,发现误差显著大于两个隐藏层的模型

|隐藏层数据|13->16->8->1|13->32->10->1|13->8->3->1|
|----------|-----------|--------------|----------|
|测试集损失|0.0185|0.151|0.0178|
2. **超参数调优**：
相同的策略，我手动调整batch_size和learning_rate，在尝试了5，16，32大小的batch,和0.05，0.01，0.005大小的学习率之后，得到最优模型的超参数32和0.05

|测试集损失|16|32|64|
|--|--|--|--|
|0.005|0.0176|0.0151|0.0192|
|0.01|0.0190|0.0175|0.0160|
|0.05|0.0167|0.0182|0.0181|

* **结果分析与模型评估**
在最后的最佳的模型之中，我们得到验证集的损失值变化为（两次测试数据）：
![图片](/损失函数曲线.png)![图片](/损失函数曲线1.png)
在测试集之中分区间的预测效果展示为：
![图片](/柱状图.png)![图片](/柱状图2.png)

1. 收敛效果：我们观察曲线，发现在前段epoch之中曲线较光滑且下降趋势明显，表明batchsize选择较为合理，但是在后半段出现波动，可能是由于学习率偏大，在最后阶段收敛效果存在问题。
2. 我们能得到在测试集的平均损失函数total loss=0.0151，模型在未遇见过的验证集上损失值很小。并且，损失曲线随着训练次数增多而减少，我们还是认为这个损失值表明了模型的准确率较高，能够比较准确的预测房价。
3. 同时，我们观察在不同价格区间的预测效果，这是通过反归一化的数据之后来计算，比上文的total loss更具有参考性和直观。分析得到：两次训练之中，模型在15-30k的mse小于一，可以认为预测的房价与实际值相差＜1k美元，是一个比较理想的值。
而在10-15k,35k+区间，可以认为是数据在比较极端的情况，预测效果出现了mse大于一，效果相对较差，可以认为模型在两侧的极端值拟合效果相对较差。

* **改进方向**
1. 改进激活函数，可以尝试使用sigmoid激活函数，可能能够减少极端情况的误差，减少模型在区间两侧的误差
2. 使用贝叶斯优化等算法，尝试更多的超参数组合和隐藏层数据。而不是手动输入然后得到数据，并且还能得到更准确的最有超参数。

* **总体结论**
总体来说，改模型总体预测的误差小于1k，是一个可接受的范围，可以认为该模型拟合效果良好，同时，存在许多值得改进的地方如超参数调优。

